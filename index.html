<!doctype html><html><head>
  <title>Fonts to PNG - Fa2PNG Alternative</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
	
 
	<meta name="viewport" content="width=device-width, initial-scale=1">

  </head><body>
  <h1>Fonts to PNG - FA2PNG Alternative</h1><div id="wrap"><div id="mwrap">
	<div id="left"><div class="form">
				<div class="label"><label>
					<span class="label">Icon</span>
		<div>
					<input type="text" name="color" id="filterinput" value="Select an icon" onclick="showfonts()" 
oninput="filter()"/></div></label>
					<div id="fontswrap" style="display:none">
  <ul id="filterul">
		
		</ul></div>
					<input type="hidden" id="fonttext" name="text" value=""/>
			</div>
		<label class="label">
			<span class="label">Size</span>
		<input type="number" name="size" id="fontsize"  value="50"/>
			<input type="range" min="1" max="600" value="50" class="slider" id="range">
			</label>
					<label class="label"><span class="label">Color</span>
		<input type="text" name="color" id="fontcolor" value="#ff0000"/>
			<button class="btn clrd" onclick="writetocanvas('')">Generate</button>
			<button class="btn" onclick="invokedownload()">Download PNG</button>
				</div>
			</div>
	<div id="right">
	<div id="stage">
 <canvas id="menuScreen" width="320" height="480"></canvas>
</div>
		<div id="div" style="display:none;"></div>
  <script>
	  	    function ajaxurl(url,callback) {
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (xhr.readyState == XMLHttpRequest.DONE) {
        callback(xhr.responseText);
    }
}
xhr.open('GET', url, true);
xhr.send(null);
}
	  
	  
    window.onload = function(){
	    ajaxurl('names.dat',function(k) {loaded(k); });
	    document.getElementById("range").oninput = function() {
          document.getElementById("range").style.background = 'linear-gradient(to right, #007efd  0%, #007efd  ' + this.value / (600-1)*100  + '%, #c1c1c1  ' + this.value / (600-1)*100 + '%, #c1c1c1  100%)';	document.getElementById('fontsize').value = this.value;
		  
		    
};
    
	
	    


	    
	  
	  	    document.getElementById("fontsize").oninput = function() {
  document.getElementById("range").style.background = 'linear-gradient(to right, #007efd  0%, #007efd  ' + this.value / (600-1)*100  + '%, #c1c1c1  ' + this.value / (600-1)*100 + '%, #c1c1c1  100%)';
	document.getElementById("range").value = this.value;
		    
		    
};
    }
    function loaded(r){
	    	    listdiv = document.getElementById('filterul');

     listdiv.innerHTML  = r;
    }
	  function textsize(txt, font) {
    this.element = document.createElement('canvas');
    this.context = this.element.getContext("2d");
    this.context.font = font;
    var sizee = {'width':this.context.measureText(txt).width, 'height':parseInt(this.context.font)};
    return sizee;
}
	  
	function  writetocanvas(){
		text =  document.getElementById('fonttext').value;
		ttext =  document.getElementById('filterinput').value;
		 size = document.getElementById('fontsize').value;
		
		if (ttext.match(/^fa-/)) {
			thef = 'FontAwesome';
			
		}
		else {
			thef = 'Ionicons';
		}
		
		fontsx = Math.abs(size);
		font = fontsx+'pt '+thef;
		textsizee = textsize(text,font);
		/*
		
		for(fontsx=fontsxy; (textsizee['width'] > size) || (textsizee['height'] > size); fontsx--){
				fontsx = fontsx-1;
			font = fontsx+'pt '+thef;
		textsizee = textsize(text,font);
			console.log(textsizee);
		}
		console.log(textsizee);
		console.log(fontsx);
			*/
	  var canvas = document.getElementById("menuScreen");
var context = canvas.getContext("2d");
		canvas.width = textsizee['width'];
		canvas.height = textsizee['height'];
		
	/*	if(textsizee['height'] < textsizee['width'])
		{
		canvas.width = size;
		theight = textsizee['height']/textsizee['width'];
		theight2 = size*theight;
		canvas.height = theight2;
		}
		else {
			canvas.height = size;
		theight = textsizee['height']/textsizee['width'];
		theight2 = size/theight;
		canvas.width = theight2;
		}
  */

context.clearRect(0, 0, canvas.width, canvas.height);
		context.beginPath();
color = document.getElementById('fontcolor').value;
		
		  context.fillStyle = color;
context.font = fontsx+'pt '+thef;
		fontr = fontsx+'pt '+thef;
	textsizeer = textsize(text,fontr);
			console.log(textsizeer);	
		//canvas.width = textWidth;
		 // canvas.height = txtHeight;
		context.textBaseline = "top";
  context.textBaseline = 'top';
 

		
context.fillText(text,0,0);
		trimCanvas(context);
		document.getElementById('fontswrap').classList.remove('show');
}
	  function clickedrow(text,e){
		  	document.getElementById('fonttext').value = text;
		
		  	document.getElementById('filterinput').value = e.textContent || e.innerText;
		  writetocanvas(text);
	  }
function filter() {
  var input, filter, ul, li, a, i, txtValue;
  input = document.getElementById('filterinput');
  filter = input.value.toUpperCase();
  ul = document.getElementById("filterul");
  li = ul.getElementsByTagName('li');
  for (i = 0; i < li.length; i++) {
    a = li[i];
    txtValue = a.textContent || a.innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      li[i].style.display = "";
    } else {
      li[i].style.display = "none";
    }
  }
}
	  
	  function invokedownload(){
		   canvas = document.getElementById("menuScreen");
	           dataURL = canvas.toDataURL("image/png"); // this is not working 
		  var downloadLink = document.createElement('a');
downloadLink.href = dataURL;
downloadLink.download = document.getElementById('filterinput').value+'.png';

document.body.appendChild(downloadLink);
downloadLink.click();
document.body.removeChild(downloadLink);
}
	  function showfonts(){
	 document.getElementById('fontswrap').classList.toggle('show');
	  }
	  
	  
	  function trimCanvas(ctx) { // removes transparent edges
    var x, y, w, h, top, left, right, bottom, data, idx1, idx2, found, imgData;
    w = ctx.canvas.width;
    h = ctx.canvas.height;
    if (!w && !h) { return false } 
    imgData = ctx.getImageData(0, 0, w, h);
    data = new Uint32Array(imgData.data.buffer);
    idx1 = 0;
    idx2 = w * h - 1;
    found = false; 
    // search from top and bottom to find first rows containing a non transparent pixel.
    for (y = 0; y < h && !found; y += 1) {
        for (x = 0; x < w; x += 1) {
            if (data[idx1++] && !top) {  
                top = y + 1;
                if (bottom) { // top and bottom found then stop the search
                    found = true; 
                    break; 
                }
            }
            if (data[idx2--] && !bottom) { 
                bottom = h - y - 1; 
                if (top) { // top and bottom found then stop the search
                    found = true; 
                    break;
                }
            }
        }
        if (y > h - y && !top && !bottom) { return false } // image is completely blank so do nothing
    }
    top -= 1; // correct top 
    found = false;
    // search from left and right to find first column containing a non transparent pixel.
    for (x = 0; x < w && !found; x += 1) {
        idx1 = top * w + x;
        idx2 = top * w + (w - x - 1);
        for (y = top; y <= bottom; y += 1) {
            if (data[idx1] && !left) {  
                left = x + 1;
                if (right) { // if left and right found then stop the search
                    found = true; 
                    break;
                }
            }
            if (data[idx2] && !right) { 
                right = w - x - 1; 
                if (left) { // if left and right found then stop the search
                    found = true; 
                    break;
                }
            }
            idx1 += w;
            idx2 += w;
        }
    }
    left -= 1; // correct left
    if(w === right - left + 1 && h === bottom - top + 1) { return true } // no need to crop if no change in size
    w = right - left + 1;
    h = bottom - top + 1;
    ctx.canvas.width = w;
    ctx.canvas.height = h;
    ctx.putImageData(imgData, -left, -top);
    return true;            
}

</script>
		<style>
		body {
    margin: 0;
    padding: 0;
    font-family: segoe ui, helvetica neue, sans-serif;
			background:#cccccc;
}

h1 {
    text-align: center;
    background: #ddd;
    margin: 0;
    padding: 10px 5px;
    font-size: 20px;
    background: linear-gradient(#e2e2e2,#cccccc);
    color: #333;
    font-weight: 600;
}
	div#left {
    background: #ececec;
    float: left;
    width: 300px;
    min-height: 100vh;
}

div#mwrap {
    max-width: 1000px;
    margin: 0 auto;
}

div#right {
    width: calc(100% - 300px);
    float: left;
	
}
			.label {
    display: block;
    padding: 5px 15px;
}

span.label {
    display: block;
    padding: 5px 5px;
    font-size: 17px;
    color: #262626;
}

.label input[type=text], .label input[type=number],.f_input {
    width: 100%;
    padding: 6px 10px;
    box-sizing: border-box;
    border: 1px solid #c6c5c5;
    border-radius: 5px;
    background: white;
    font-size: 17px;
    box-shadow: 0px 0px 1px #c6c5c5;
}
			div#fontswrap.show {
       width: 266px;
    height: 151px;
    display: block !important;
    overflow: auto;
    position: absolute;
    background: white;
    margin: 0px 2px;
    margin-top: 0px;
    box-shadow: 0px 8px 10px #aeaeae;
    border-radius: 5px;
}

li.filterli {
    list-style-position: inside;
    list-style-type: none;
    padding: 5px 15px;
    border-bottom: 1px solid #ddd;
}

ul#filterul {
    margin: 0;
    padding: 0;
}

input#filterinput {
    width: 100%;
    padding: 6px 10px;
    box-sizing: border-box;
    border: 1px solid #c6c5c5;
    border-radius: 5px;
    background: white;
    font-size: 17px;
    box-shadow: 0px 0px 1px #c6c5c5;
}
			li.filterli:hover {
    background: #007efd;
    color: white;
}
			button.btn {
    width: 100%;
    padding: 8px 10px;
    box-sizing: border-box;
    border: 1px solid #c6c5c5;
    border-radius: 5px;
    background: white;
    font-size: 17px;
    box-shadow: 0px 0px 1px #c6c5c5;
    margin: 10px 0px 0px;
    cursor: pointer;
    text-align: center;
}

button.btn.clrd {background: #007efd;color: white;}
			
			div#stage {
				    text-align: center;
    background: white;
    min-height: 100vh;
    padding-top: 100px;

  background-image: linear-gradient(45deg, #f2f2f2 25%, transparent 25%), linear-gradient(-45deg, #f2f2f2 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #f2f2f2 75%), linear-gradient(-45deg, transparent 75%, #f2f2f2 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
}

canvas#menuScreen {
    max-height: 300px;
    max-width: 300px;
    margin: 0 auto;

}
	.slider {
    -webkit-appearance: none;
    width: 100%;
    height: 5px;
    background: #c1c1c1;
    background:linear-gradient(to right, rgb(0, 126, 253) 0%, rgb(0, 126, 253) 8.34725%, rgb(193, 193, 193) 8.34725%, rgb(193, 193, 193) 100%);
    outline: none;
    -webkit-transition: .2s;

}
.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 25px;
  height: 25px;
  background: white;
  cursor: pointer;
  border:1px solid #c7c7c7;
  border-radius:100%;


}		
@media (max-width:992px) {
	div#left {
    float: none;
    width: auto;
    min-height: auto;
    padding: 10px 0px;
}

div#right {
    float: none;
    width: auto;
}
			}
		</style>
  </body></html>
